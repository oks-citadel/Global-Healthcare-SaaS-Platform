# ============================================
# Production Ingress - Simplified Configuration
# ============================================
# NOTE: For production with full security features, prefer using:
#   infrastructure/kubernetes/base/ingress/ingress.yaml
#
# The base ingress includes:
#   - TLS with cert-manager
#   - Rate limiting
#   - Security headers (X-Frame-Options, CSP, etc.)
#   - CORS configuration
#   - WAF with ModSecurity
#   - WebSocket support
#
# This simplified ingress is provided for basic routing only.
# ============================================
apiVersion: networking.k8s.io/v1
kind: Ingress
metadata:
  name: unified-health-prod-ingress
  namespace: unified-health-prod
  labels:
    app: unified-health
    version: "1.0.0"
  annotations:
    nginx.ingress.kubernetes.io/ssl-redirect: "false"
    nginx.ingress.kubernetes.io/proxy-body-size: "10m"
    nginx.ingress.kubernetes.io/proxy-read-timeout: "60"
    nginx.ingress.kubernetes.io/use-regex: "true"
    nginx.ingress.kubernetes.io/rewrite-target: /$2
spec:
  ingressClassName: nginx
  rules:
  - http:
      paths:
      # Service paths with rewrite
      - path: /telehealth(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: telehealth-service
            port:
              number: 80
      - path: /mental-health(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: mental-health-service
            port:
              number: 80
      - path: /chronic-care(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: chronic-care-service
            port:
              number: 80
      - path: /pharmacy(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: pharmacy-service
            port:
              number: 80
      - path: /laboratory(/|$)(.*)
        pathType: ImplementationSpecific
        backend:
          service:
            name: laboratory-service
            port:
              number: 80
      # Root and health - API Gateway (no rewrite needed)
      - path: /
        pathType: Prefix
        backend:
          service:
            name: api-gateway
            port:
              number: 80
