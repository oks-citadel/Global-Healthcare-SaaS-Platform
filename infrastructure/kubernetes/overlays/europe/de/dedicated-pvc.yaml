# Germany Dedicated Persistent Volume Claims
# Isolated storage for German patient data - no cross-border storage

apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: de-medical-records-pvc
  namespace: healthcare-de
  labels:
    app: medical-records
    country: de
    data-residency: isolated
spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 200Gi
  storageClassName: de-isolated-storage
  volumeMode: Filesystem
  selector:
    matchLabels:
      country: de
      type: medical-records

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: de-lab-results-pvc
  namespace: healthcare-de
  labels:
    app: laboratory-service
    country: de
    data-residency: isolated
spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 100Gi
  storageClassName: de-isolated-storage
  volumeMode: Filesystem
  selector:
    matchLabels:
      country: de
      type: lab-results

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: de-medical-images-pvc
  namespace: healthcare-de
  labels:
    app: imaging-service
    country: de
    data-residency: isolated
spec:
  accessModes:
  - ReadWriteMany
  resources:
    requests:
      storage: 500Gi
  storageClassName: de-isolated-storage
  volumeMode: Filesystem
  selector:
    matchLabels:
      country: de
      type: medical-images

---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: de-database-pvc
  namespace: healthcare-de
  labels:
    app: postgresql
    country: de
    data-residency: isolated
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 200Gi
  storageClassName: de-isolated-storage-ssd
  volumeMode: Filesystem
  selector:
    matchLabels:
      country: de
      type: database

---
# Storage Class definition for Germany isolated storage
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: de-isolated-storage
  labels:
    country: de
    data-residency: isolated
provisioner: kubernetes.io/aws-ebs  # Replace with your cloud provider
parameters:
  type: gp3
  encrypted: "true"
  kmsKeyId: "alias/healthcare-de-kms"  # Germany-specific KMS key
  fsType: ext4
  # Ensure storage is created in Germany region only
  zones: eu-central-1a,eu-central-1b,eu-central-1c
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain  # Never delete data automatically

---
# Storage Class for SSD (database)
apiVersion: storage.k8s.io/v1
kind: StorageClass
metadata:
  name: de-isolated-storage-ssd
  labels:
    country: de
    data-residency: isolated
provisioner: kubernetes.io/aws-ebs
parameters:
  type: io2
  iops: "10000"
  encrypted: "true"
  kmsKeyId: "alias/healthcare-de-kms"
  fsType: ext4
  zones: eu-central-1a,eu-central-1b,eu-central-1c
allowVolumeExpansion: true
volumeBindingMode: WaitForFirstConsumer
reclaimPolicy: Retain
