---
# ============================================
# Pod Disruption Budget - Auth Service
# Ensures high availability for the authentication service
# ============================================
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: auth-pdb
  namespace: unified-health
  labels:
    app.kubernetes.io/name: unified-health-auth
    app.kubernetes.io/component: auth-service
    app.kubernetes.io/part-of: unified-health-platform
    app.kubernetes.io/managed-by: kustomize
  annotations:
    description: "Ensures minimum 1 auth pod is always available during voluntary disruptions"
    documentation: "https://docs.unifiedhealth.com/infrastructure/pdb"
spec:
  # Minimum number of pods that must remain available during voluntary disruptions
  # With minAvailable: 1, at least 1 auth pod must be running at all times
  # Requires at least 2 replicas to allow any voluntary disruption
  minAvailable: 1

  selector:
    matchLabels:
      app.kubernetes.io/name: unified-health-auth
      app.kubernetes.io/component: auth-service

  # Unhealthy pod eviction policy determines how unhealthy pods are handled
  # IfHealthyBudget: Allow eviction of unhealthy pods if healthy pods satisfy the budget
  # AlwaysAllow: Always allow eviction of unhealthy pods regardless of budget
  unhealthyPodEvictionPolicy: IfHealthyBudget
