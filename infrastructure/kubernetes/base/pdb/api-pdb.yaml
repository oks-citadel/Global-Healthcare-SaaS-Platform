---
# ============================================
# Pod Disruption Budget - API Deployment
# Ensures high availability for the main API service
# ============================================
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: api-pdb
  namespace: unified-health
  labels:
    app.kubernetes.io/name: unified-health-api
    app.kubernetes.io/component: api
    app.kubernetes.io/part-of: unified-health-platform
    app.kubernetes.io/managed-by: kustomize
  annotations:
    description: "Ensures minimum 2 API pods are always available during voluntary disruptions"
    documentation: "https://docs.unifiedhealth.com/infrastructure/pdb"
spec:
  # Minimum number of pods that must remain available during voluntary disruptions
  # With minAvailable: 2, at least 2 API pods must be running at all times
  # Requires at least 3 replicas to allow any voluntary disruption
  minAvailable: 2

  selector:
    matchLabels:
      app.kubernetes.io/name: unified-health-api
      app.kubernetes.io/component: api

  # Unhealthy pod eviction policy determines how unhealthy pods are handled
  # IfHealthyBudget: Allow eviction of unhealthy pods if healthy pods satisfy the budget
  # AlwaysAllow: Always allow eviction of unhealthy pods regardless of budget
  unhealthyPodEvictionPolicy: IfHealthyBudget
