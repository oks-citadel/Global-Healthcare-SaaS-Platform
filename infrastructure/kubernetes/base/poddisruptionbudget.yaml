---
# ============================================
# The Unified Health API - Pod Disruption Budget
# Ensures high availability during voluntary disruptions
# ============================================
apiVersion: policy/v1
kind: PodDisruptionBudget
metadata:
  name: unified-health-api-pdb
  namespace: unified-health
  labels:
    app: unified-health-api
    component: availability
spec:
  # Minimum number of pods that must be available during disruption
  # This will be overridden in overlays for different environments
  minAvailable: 1

  selector:
    matchLabels:
      app: unified-health-api

  # Alternative: Use maxUnavailable instead of minAvailable
  # maxUnavailable: 1

  # Unhealthy pod eviction policy
  unhealthyPodEvictionPolicy: IfHealthyBudget

---
# ============================================
# Notes on Pod Disruption Budget
# ============================================
#
# minAvailable: Minimum pods that must remain available
# - Staging: 1 (allows disruption of 1 pod when there are 2 replicas)
# - Production: 2 (allows disruption of 1 pod when there are 3+ replicas)
#
# maxUnavailable: Maximum pods that can be unavailable
# - Alternative approach to minAvailable
# - Useful when you want to express as a percentage
#
# Voluntary disruptions include:
# - Node draining for maintenance
# - Rolling updates
# - Pod evictions
# - Cluster autoscaling
#
# Involuntary disruptions (not covered by PDB):
# - Hardware failures
# - Kernel panics
# - Network partitions
# - Out of resource conditions
# ============================================
