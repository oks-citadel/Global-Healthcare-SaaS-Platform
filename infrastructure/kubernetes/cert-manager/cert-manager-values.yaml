# ============================================
# cert-manager Helm Values for Azure Workload Identity
# ============================================
# Use these values when installing/upgrading cert-manager
# to enable Azure Workload Identity integration
#
# Install command:
# helm upgrade --install cert-manager jetstack/cert-manager \
#   --namespace cert-manager \
#   --create-namespace \
#   --version v1.16.2 \
#   --values cert-manager-values.yaml
# ============================================

# Install CRDs (Custom Resource Definitions)
crds:
  enabled: true
  keep: true

# Global settings
global:
  leaderElection:
    namespace: cert-manager

# Controller configuration
controller:
  replicas: 2

  # Pod labels for Azure Workload Identity
  podLabels:
    azure.workload.identity/use: "true"

  # Service account configuration
  serviceAccount:
    # Annotations for Azure Workload Identity
    annotations:
      # IMPORTANT: Replace with your managed identity client ID
      azure.workload.identity/client-id: "YOUR_MANAGED_IDENTITY_CLIENT_ID"

  # Resource limits
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 256Mi

  # Pod disruption budget
  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  # Node selector for system node pool
  nodeSelector:
    nodepool-type: system

  # Tolerations
  tolerations: []

  # Pod anti-affinity for high availability
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/component
              operator: In
              values:
              - controller
          topologyKey: kubernetes.io/hostname

# Webhook configuration
webhook:
  replicas: 2

  # Pod labels for consistency
  podLabels:
    azure.workload.identity/use: "true"

  # Service account for webhook
  serviceAccount:
    annotations:
      azure.workload.identity/client-id: "YOUR_MANAGED_IDENTITY_CLIENT_ID"

  resources:
    requests:
      cpu: 25m
      memory: 32Mi
    limits:
      cpu: 100m
      memory: 128Mi

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  nodeSelector:
    nodepool-type: system

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/component
              operator: In
              values:
              - webhook
          topologyKey: kubernetes.io/hostname

# CA Injector configuration
cainjector:
  enabled: true
  replicas: 2

  podLabels:
    azure.workload.identity/use: "true"

  serviceAccount:
    annotations:
      azure.workload.identity/client-id: "YOUR_MANAGED_IDENTITY_CLIENT_ID"

  resources:
    requests:
      cpu: 25m
      memory: 64Mi
    limits:
      cpu: 100m
      memory: 128Mi

  podDisruptionBudget:
    enabled: true
    minAvailable: 1

  nodeSelector:
    nodepool-type: system

  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
      - weight: 100
        podAffinityTerm:
          labelSelector:
            matchExpressions:
            - key: app.kubernetes.io/component
              operator: In
              values:
              - cainjector
          topologyKey: kubernetes.io/hostname

# startupapicheck configuration
startupapicheck:
  enabled: true

  resources:
    requests:
      cpu: 10m
      memory: 32Mi
    limits:
      cpu: 50m
      memory: 64Mi

  nodeSelector:
    nodepool-type: system

# Prometheus ServiceMonitor (if prometheus-operator is installed)
prometheus:
  enabled: true
  servicemonitor:
    enabled: true
    prometheusInstance: default
    targetPort: 9402
    path: /metrics
    interval: 30s
    scrapeTimeout: 10s
    labels:
      release: prometheus

# Logging
# Set log level to debug for troubleshooting DNS-01 issues
# logLevel: 2  # Default
# logLevel: 6  # Debug level for troubleshooting

# Feature gates (enable if needed)
# featureGates: "ExperimentalGatewayAPISupport=true"
