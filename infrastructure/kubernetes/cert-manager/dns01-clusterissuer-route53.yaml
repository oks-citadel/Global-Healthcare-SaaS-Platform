# ============================================
# DNS-01 ClusterIssuer for AWS Route53
# ============================================
# This configuration uses AWS Route53 with IRSA
# for DNS-01 ACME challenges (recommended approach)
#
# Prerequisites:
# 1. Route53 hosted zone exists in your AWS account
# 2. EKS cluster has IRSA enabled
# 3. IAM role with Route53 permissions
# 4. Service account configured for cert-manager
# ============================================

---
# Production ClusterIssuer with Route53 (IRSA)
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-prod-dns01
  labels:
    app.kubernetes.io/name: cert-manager
    app.kubernetes.io/component: cluster-issuer
    app.kubernetes.io/part-of: unified-health
spec:
  acme:
    # Production Let's Encrypt server
    server: https://acme-v02.api.letsencrypt.org/directory

    # Email for certificate expiration notifications
    # IMPORTANT: Replace with your actual email
    email: platform-admin@unifiedhealth.com

    # Secret to store the ACME account private key
    privateKeySecretRef:
      name: letsencrypt-prod-dns01-account-key

    solvers:
    # DNS-01 solver using Route53 with IRSA
    - dns01:
        route53:
          # AWS region for Route53
          region: us-east-1

          # Route53 hosted zone ID
          # IMPORTANT: Replace with your actual hosted zone ID
          hostedZoneID: "YOUR_HOSTED_ZONE_ID"

---
# Staging ClusterIssuer for testing (uses Let's Encrypt staging)
apiVersion: cert-manager.io/v1
kind: ClusterIssuer
metadata:
  name: letsencrypt-staging-dns01
  labels:
    app.kubernetes.io/name: cert-manager
    app.kubernetes.io/component: cluster-issuer
    app.kubernetes.io/part-of: unified-health
spec:
  acme:
    # Staging Let's Encrypt server (for testing)
    server: https://acme-staging-v02.api.letsencrypt.org/directory

    email: platform-admin@unifiedhealth.com

    privateKeySecretRef:
      name: letsencrypt-staging-dns01-account-key

    solvers:
    - dns01:
        route53:
          region: us-east-1
          hostedZoneID: "YOUR_HOSTED_ZONE_ID"
