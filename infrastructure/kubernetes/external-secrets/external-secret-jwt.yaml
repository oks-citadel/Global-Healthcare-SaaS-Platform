---
# ============================================
# ExternalSecret - JWT and Authentication Secrets
# ============================================
# Syncs JWT and authentication secrets from AWS Secrets Manager
#
# AWS Secret Structure (unified-health/jwt):
# {
#   "jwt_secret": "your-jwt-secret-min-32-characters",
#   "jwt_refresh_secret": "your-refresh-secret-min-32-characters",
#   "encryption_key": "your-32-byte-encryption-key"
# }
# ============================================
apiVersion: external-secrets.io/v1beta1
kind: ExternalSecret
metadata:
  name: jwt-secrets
  namespace: unified-health
  labels:
    app.kubernetes.io/name: jwt-secrets
    app.kubernetes.io/component: external-secret
spec:
  refreshInterval: 1h

  secretStoreRef:
    name: aws-secrets-manager
    kind: ClusterSecretStore

  target:
    name: jwt-secrets
    creationPolicy: Owner
    template:
      type: Opaque
      metadata:
        labels:
          app: unified-health
          component: authentication
      data:
        JWT_SECRET: "{{ .jwt_secret }}"
        JWT_REFRESH_SECRET: "{{ .jwt_refresh_secret }}"
        ENCRYPTION_KEY: "{{ .encryption_key }}"

  data:
    - secretKey: jwt_secret
      remoteRef:
        key: unified-health/jwt
        property: jwt_secret
    - secretKey: jwt_refresh_secret
      remoteRef:
        key: unified-health/jwt
        property: jwt_refresh_secret
    - secretKey: encryption_key
      remoteRef:
        key: unified-health/jwt
        property: encryption_key
