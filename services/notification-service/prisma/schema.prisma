generator client {
  output   = "./../src/generated/client"
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum NotificationChannel {
  email
  sms
  push
  in_app
}

enum NotificationStatus {
  pending
  queued
  sent
  delivered
  failed
  read
}

enum NotificationPriority {
  low
  normal
  high
  urgent
}

model Notification {
  id            String               @id @default(uuid())
  userId        String               @map("user_id")
  type          String
  title         String?
  message       String
  channel       NotificationChannel
  status        NotificationStatus   @default(pending)
  priority      NotificationPriority @default(normal)
  metadata      Json?
  templateId    String?              @map("template_id")
  scheduledAt   DateTime?            @map("scheduled_at")
  sentAt        DateTime?            @map("sent_at")
  deliveredAt   DateTime?            @map("delivered_at")
  readAt        DateTime?            @map("read_at")
  failedAt      DateTime?            @map("failed_at")
  failureReason String?              @map("failure_reason")
  retryCount    Int                  @default(0) @map("retry_count")
  createdAt     DateTime             @default(now()) @map("created_at")
  updatedAt     DateTime             @updatedAt @map("updated_at")

  @@index([userId, status])
  @@index([userId, createdAt])
  @@index([status, scheduledAt])
  @@map("notifications")
}

model NotificationTemplate {
  id          String              @id @default(uuid())
  name        String              @unique
  type        String
  subject     String?
  body        String
  variables   String[]
  channel     NotificationChannel
  locale      String              @default("en")
  isActive    Boolean             @default(true) @map("is_active")
  createdAt   DateTime            @default(now()) @map("created_at")
  updatedAt   DateTime            @updatedAt @map("updated_at")

  @@index([channel, locale])
  @@index([type])
  @@map("notification_templates")
}

model NotificationPreference {
  id        String              @id @default(uuid())
  userId    String              @map("user_id")
  channel   NotificationChannel
  enabled   Boolean             @default(true)
  settings  Json?
  createdAt DateTime            @default(now()) @map("created_at")
  updatedAt DateTime            @updatedAt @map("updated_at")

  @@unique([userId, channel])
  @@index([userId])
  @@map("notification_preferences")
}

model QuietHours {
  id        String   @id @default(uuid())
  userId    String   @unique @map("user_id")
  enabled   Boolean  @default(false)
  startTime String   @map("start_time")
  endTime   String   @map("end_time")
  timezone  String   @default("UTC")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("quiet_hours")
}

model DeviceToken {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  token     String   @unique
  platform  String   // ios, android, web
  isActive  Boolean  @default(true) @map("is_active")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([userId, isActive])
  @@map("device_tokens")
}
