version: '3.8'

services:
  imaging-service:
    build: .
    container_name: imaging-service
    ports:
      - "3006:3006"
    environment:
      - NODE_ENV=production
      - PORT=3006
      - DATABASE_URL=postgresql://imaging_user:imaging_pass@postgres:5432/imaging_db
      - AZURE_STORAGE_CONNECTION_STRING=${AZURE_STORAGE_CONNECTION_STRING}
      - AZURE_STORAGE_CONTAINER_NAME=medical-images
      - NOTIFICATION_SERVICE_URL=http://notification-service:3003
      - EHR_SERVICE_URL=http://ehr-service:3001
      - JWT_SECRET=${JWT_SECRET}
    depends_on:
      - postgres
    networks:
      - imaging-network
    restart: unless-stopped

  postgres:
    image: postgres:15-alpine
    container_name: imaging-postgres
    environment:
      - POSTGRES_USER=imaging_user
      - POSTGRES_PASSWORD=imaging_pass
      - POSTGRES_DB=imaging_db
    ports:
      - "5436:5432"
    volumes:
      - postgres-data:/var/lib/postgresql/data
    networks:
      - imaging-network
    restart: unless-stopped

volumes:
  postgres-data:

networks:
  imaging-network:
    driver: bridge
