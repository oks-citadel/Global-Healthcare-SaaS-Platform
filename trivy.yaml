# ============================================
# UnifiedHealth Platform - Trivy Configuration
# Container & Filesystem Security Scanning
# ============================================

# Scan settings
scan:
  # Security checks to perform
  security-checks:
    - vuln      # Vulnerabilities
    - config    # Misconfigurations
    - secret    # Secret detection
    - license   # License scanning

  # Vulnerability settings
  vulnerability:
    # Vulnerability types to detect
    type:
      - os      # OS packages
      - library # Application dependencies

  # Offline mode (use local database)
  offline-scan: false

  # Skip files/directories
  skip-files:
    - "**/*.test.ts"
    - "**/*.test.tsx"
    - "**/*.spec.ts"
    - "**/*.spec.tsx"
    - "**/node_modules/**"
    - "**/.git/**"

  skip-dirs:
    - node_modules
    - .git
    - dist
    - build
    - .next
    - coverage

# Severity levels to report
severity:
  - CRITICAL
  - HIGH
  - MEDIUM
  - LOW
  - UNKNOWN

# Exit code settings
exit-code: 1  # Fail on vulnerabilities

# Exit with zero code when vulnerabilities are found but below threshold
exit-on-eol: 1  # Fail on end-of-life OS

# Ignore unfixed vulnerabilities
ignore-unfixed: false

# Vulnerability database
db:
  # Skip database update
  skip-update: false

  # Database repository
  repository: ghcr.io/aquasecurity/trivy-db

  # Light mode (smaller database)
  light: false

# Report settings
format: table  # Options: table, json, sarif, template, cyclonedx, spdx

# Template for custom output (if format: template)
# template: "@contrib/html.tpl"

# Output file
# output: trivy-report.json

# Cache settings
cache:
  # Cache backend (fs, redis, memcached)
  backend: fs

  # Cache directory
  dir: .trivy-cache

  # Note: cache clearing is now done via 'trivy clean --scan-cache'
  # The 'clear' option was removed in newer Trivy versions

# Timeout settings
timeout: 5m0s

# Vulnerability filtering
vuln-type:
  - os
  - library

# Ignore policy file
ignorefile: .trivyignore

# ============================================
# Container Image Scanning
# ============================================

# Image scanning options (when scanning container images)
image:
  # Remove downloaded images after scanning
  removed-pkgs: false

  # Docker settings
  docker:
    host: unix:///var/run/docker.sock

# ============================================
# Kubernetes Scanning
# ============================================

kubernetes:
  # Kubernetes manifest scanning
  components:
    - workload
    - infra
    - rbac

# ============================================
# Secret Detection
# ============================================

secret:
  # Secret scanning configuration
  config: .trivy-secret.yaml

# ============================================
# License Scanning
# ============================================

license:
  # License types to flag
  full: false

  # Forbidden licenses
  forbidden:
    - GPL-3.0
    - AGPL-3.0
    - LGPL-3.0

# ============================================
# Misconfiguration Detection
# ============================================

misconfiguration:
  # Scan for misconfigurations
  scanners:
    - dockerfile
    - terraform
    - kubernetes
    - cloudformation

  # Policy paths
  policy-paths:
    - policy/

  # Namespaces to use
  policy-namespaces:
    - builtin.dockerfile
    - builtin.kubernetes
    - builtin.terraform

  # Include deprecated checks
  include-deprecated-checks: false

  # Helm values files
  helm-values:
    - values.yaml
    - values-production.yaml

  # Terraform variables
  tf-vars:
    - terraform.tfvars
    - production.tfvars

# ============================================
# SBOM (Software Bill of Materials)
# ============================================

# SBOM format (cyclonedx, spdx)
# sbom-format: cyclonedx

# ============================================
# Compliance
# ============================================

# Compliance standards to check against
compliance:
  # spec: hipaa  # Healthcare compliance
  # spec: pci-dss  # Payment card industry
  # spec: gdpr  # Data protection

# ============================================
# HealthCheck & Retry
# ============================================

# Registry settings
registry:
  # Registry authentication
  # username: ""
  # password: ""

  # Insecure registry
  insecure: false

# ============================================
# Quiet mode
# ============================================

# Suppress progress bar
quiet: false

# Debug mode
debug: false

# ============================================
# File Patterns
# ============================================

# File patterns to scan
file-patterns:
  # Dockerfile patterns
  - "Dockerfile"
  - "Dockerfile.*"
  - "*.dockerfile"

  # Terraform patterns
  - "*.tf"
  - "*.tfvars"

  # Kubernetes patterns
  - "*.yaml"
  - "*.yml"

  # Config files
  - "docker-compose.yml"
  - "docker-compose.*.yml"
